#!/bin/bash

set -e

echo "Starting puma"

# touch logs that would be generated by puma
touch /var/log/gitlab/production.log

# pre-create known-good tmpdir
export TMPDIR=/tmp/gitlab
mkdir -p -m 3770 $TMPDIR

cd /srv/gitlab
/srv/gitlab/bin/bundle exec puma --environment production --config /srv/gitlab/config/puma.rb /srv/gitlab/config.ru &

tail -f /var/log/gitlab/*

wait
