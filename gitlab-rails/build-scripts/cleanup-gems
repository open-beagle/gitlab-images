#!/bin/bash

set -e

# exclude rubygems build cache
rm -rf vendor/bundle/ruby/*/cache

# exclude test and some vendor folders
rm -rf \
  vendor/bundle/ruby/*/gems/*/spec \
  vendor/bundle/ruby/*/gems/*/test \
  vendor/bundle/ruby/*/gems/*/tests

# Some vendor folders (e.g. licensee) are needed by GitLab.
# For now, exclude the most space-consuming gems until
# there's a better way to whitelist directories.
rm -rf \
  vendor/bundle/ruby/*/gems/rugged*/vendor \
  vendor/bundle/ruby/*/gems/ace-rails*/vendor \
  vendor/bundle/ruby/*/gems/libyajl2*/**/vendor

# exclude gem build logs
rm -rf \
  vendor/bundle/ruby/*/extensions/*/*/*/mkmf.log \
  vendor/bundle/ruby/*/extensions/*/*/*/gem_make.out

# exclude C sources
rm -rf \
  vendor/bundle/ruby/*/gems/*/ext/*.c \
  vendor/bundle/ruby/*/gems/*/ext/*/*.c \
  vendor/bundle/ruby/*/gems/*/ext/*.o \
  vendor/bundle/ruby/*/gems/*/ext/*/*.o

# exclude other gem files
rm -rf \
  vendor/bundle/ruby/*/gems/*/*.gemspec \
  vendor/bundle/ruby/*/gems/*/*.md \
  vendor/bundle/ruby/*/gems/*/*.rdoc \
  vendor/bundle/ruby/*/gems/*/*.sh \
  vendor/bundle/ruby/*/gems/*/*.txt \
  vendor/bundle/ruby/*/gems/*/*LICENSE* \
  vendor/bundle/ruby/*/gems/*/CHANGES* \
  vendor/bundle/ruby/*/gems/*/Gemfile \
  vendor/bundle/ruby/*/gems/*/Guardfile \
  vendor/bundle/ruby/*/gems/*/README* \
  vendor/bundle/ruby/*/gems/*/Rakefile \
  vendor/bundle/ruby/*/gems/*/run_tests.rb \
  vendor/bundle/ruby/*/gems/*/Documentation \
  vendor/bundle/ruby/*/gems/*/bench \
  vendor/bundle/ruby/*/gems/*/contrib \
  vendor/bundle/ruby/*/gems/*/doc \
  vendor/bundle/ruby/*/gems/*/doc-api \
  vendor/bundle/ruby/*/gems/*/examples \
  vendor/bundle/ruby/*/gems/*/fixtures \
  vendor/bundle/ruby/*/gems/*/gemfiles \
  vendor/bundle/ruby/*/gems/*/libtest \
  vendor/bundle/ruby/*/gems/*/man \
  vendor/bundle/ruby/*/gems/*/sample_documents \
  vendor/bundle/ruby/*/gems/*/samples \
  vendor/bundle/ruby/*/gems/*/script \
  vendor/bundle/ruby/*/gems/*/t
