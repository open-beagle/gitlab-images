#!/bin/bash

set -e

echo "Starting unicorn"

# touch logs that would be generated by Unicorn
touch /var/log/gitlab/production.log

# pre-create known-good tmpdir
export TMPDIR=/tmp/gitlab
mkdir -p -m 3770 $TMPDIR

/srv/gitlab/bin/bundle exec unicorn -E production -c /srv/gitlab/config/unicorn.rb /srv/gitlab/config.ru &

tail -f /var/log/gitlab/*

wait
